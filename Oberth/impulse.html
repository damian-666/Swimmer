<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbital Simulation with Impulse Kicker</title>
    <style>
        canvas {
            background: black;
            display: block;
            margin: 0 auto;
        }
        body {
            text-align: center;
            color: white;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <h1>Orbital Simulation with Impulse Kick</h1>
    <canvas id="orbitCanvas" width="600" height="600"></canvas>
    <button id="impulseButton">Apply Impulse</button>
    <script>
        const canvas = document.getElementById("orbitCanvas");
        const ctx = canvas.getContext("2d");
        const G = 1;  // Gravitational constant (simplified)
        const M = 1000;  // Mass of the central body

        // Main body representing the satellite
        let body = {
            x: 300, y: 100,  // Initial position
            vx: 0.5, vy: 1.0,  // Initial velocity
            mass: 200  // Mass of main body
        };

        // Kicker body representing an ejected mass
        let kicker = {
            x: body.x, y: body.y,  // Start at main body position
            vx: 0, vy: 0,  // Initial velocity
            mass: 20  // Mass of kicker body
        };

        const centralBody = { x: 300, y: 300 };  // Fixed central mass

        function updatePosition(body, kicker, dt) {
            // Calculate distance from central body
            const dx = centralBody.x - body.x;
            const dy = centralBody.y - body.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            // Gravitational force
            const force = (G * M * body.mass) / (distance * distance);
            const ax = force * (dx / distance) / body.mass;
            const ay = force * (dy / distance) / body.mass;

            // Update main body's velocity and position
            body.vx += ax * dt;
            body.vy += ay * dt;
            body.x += body.vx * dt;
            body.y += body.vy * dt;

            // Magnetic-like constraint force to pull kicker back to body
            const kdx = body.x - kicker.x;
            const kdy = body.y - kicker.y;
            const kickerDistance = Math.sqrt(kdx * kdx + kdy * kdy);
            const magneticForce = kickerDistance > 1 ? 0.1 / kickerDistance : 0;

            kicker.vx += magneticForce * (kdx / kickerDistance);
            kicker.vy += magneticForce * (kdy / kickerDistance);
            kicker.x += kicker.vx * dt;
            kicker.y += kicker.vy * dt;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw central body
            ctx.beginPath();
            ctx.arc(centralBody.x, centralBody.y, 10, 0, 2 * Math.PI);
            ctx.fillStyle = "yellow";
            ctx.fill();

            // Draw main body (satellite)
            ctx.beginPath();
            ctx.arc(body.x, body.y, 5, 0, 2 * Math.PI);
            ctx.fillStyle = "white";
            ctx.fill();

            // Draw kicker body
            ctx.beginPath();
            ctx.arc(kicker.x, kicker.y, 3, 0, 2 * Math.PI);
            ctx.fillStyle = "red";
            ctx.fill();
        }

        function applyImpulse() {
            const dx = body.x - centralBody.x;
            const dy = body.y - centralBody.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            // Apply impulse when close to perigee
            if (distance < 120) {
                const impulseMagnitude = 1.5;  // Tunable impulse magnitude
                body.vx += impulseMagnitude * (dx / distance);
                body.vy += impulseMagnitude * (dy / distance);
                kicker.vx -= impulseMagnitude * (dx / distance);  // Reaction on kicker
                kicker.vy -= impulseMagnitude * (dy / distance);
            }
        }

        document.getElementById("impulseButton").addEventListener("click", applyImpulse);

        function loop() {
            updatePosition(body, kicker, 0.1);
            draw();
            requestAnimationFrame(loop);
        }

        // Start the simulation loop
        loop();
    </script>
</body>
</html>
